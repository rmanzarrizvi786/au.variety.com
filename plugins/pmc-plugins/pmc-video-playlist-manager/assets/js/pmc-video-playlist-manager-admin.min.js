/*! 
 * PMC Video Playlist Manager JavaScript Library 
 */
!function(a,b){var c=function(){var c=this,d=PMC_VIDEO_PLAYLIST_MANAGER.url,e=PMC_VIDEO_PLAYLIST_MANAGER.nonce;c.initialize=function(){var a=b("#action-delete");b("#new-video-config").click(c.createVideoConfig),b(document).on("click",".pvm-ajax-edit",c.updatePvm),b(document).on("click",".pvm-ajax-delete",c.deletePvm),b(document).on("click","#action-delete",c.deleteSelectedPvms),b(document).on("click",".pvm-form-cancel",c.cancelForm),b(document).on("submit",".pvm-provider form",c.handleForm),b(document).on("input",".playlist-search-autocomplete",c.updatePlaylist),b(document).on("change",'input[name="video-count"]',c.updatePlaylistDetail),b(document).on("click",".add-tax-relation",c.addTaxRelation),b(document).on("click",".remove-tax-relation",c.removeTaxRelation),b(document).on("keydown","input.pvm-target-term",c.updateTerm),b(document).on("change","select.pvm-target-tax",c.updateTermFieldText),b(".pvm-post-cb-all").change(function(){var c=b(".pvm-post-cb-all");b("input.pvm-post-cb").prop("checked",c.prop("checked")),c.prop("checked")?a.prop("disabled",!1):a.prop("disabled",!0)}),b("input.pvm-post-cb").on("change",function(){b("input.pvm-post-cb:checked").length?a.prop("disabled",!1):a.prop("disabled",!0)})},c.createVideoConfig=function(){var f=b("<div>",{"class":"loading"});b("#provider-forms").empty().append(f),b(a).scrollTop(b("#video-configurations").position().top),b.get(d,{action:"pvm_view",nonce:e},function(d){b("#provider-forms").empty().append(d),b(a).scrollTop(b("#video-configurations").position().top),c.updateAddTaxButton()})},c.cancelForm=function(){return b(this).parents(".pvm-provider").remove(),!1},c.handleForm=function(){var a,f,g,h,i,j=b(this),k=j.find(".form-required"),l=0;return k.removeClass("form-error"),k.find("input").each(function(){var a=b(this),c=a.val(),d=!1;if(!a.attr("disabled")){switch(c||(d=!0),a.prop("type").toLowerCase()){case"number":isNaN(c)&&(d=!0)}d&&(a.parent().addClass("form-error"),l++)}}),a=b("input.timeframe-end").parent(),f=b("input.timeframe-start").val(),g=b("input.timeframe-end").val(),h=new Date(f).valueOf(),i=new Date(g).valueOf(),""!==f&&isNaN(h)||""!==g&&isNaN(i)?(a.addClass("form-error"),alert("Please enter valid date"),l++):h>i?(a.addClass("form-error"),b("span.error-msg").show(),l++):(b("span.error-msg").hide(),a.removeClass("form-error")),l||(b('input[type="submit"]').attr("disabled",!0),b.post(d,j.serialize()+"&nonce="+e,c.ajaxCallback,"json")),!1},c.ajaxCallback=function(a){a.success?location.reload(!0):(b('input[type="submit"]').attr("disabled",!1),alert(a.message))},c.updatePvm=function(){var f=b(this).parents("tr"),g=b("<div>",{"class":"loading"});b("#provider-forms").empty().append(g),b(a).scrollTop(b("#video-configurations").position().top),b.get(d,{action:"pvm_view",nonce:e,id:f.data("id")},function(d){b("#provider-forms").empty().append(d),b(a).scrollTop(b("#video-configurations").position().top),c.updateAddTaxButton()})},c.deletePvm=function(){confirm("Are you sure you want to delete?")&&(b('input[type="submit"]').attr("disabled",!0),b.post(d,{action:"pvm_crud",nonce:e,method:"delete",id:b(this).parents("tr").data("id")},c.ajaxCallback,"json"))},c.deleteSelectedPvms=function(){var a,f=b("input.pvm-post-cb:checked");return f.length?void(confirm("Are you sure you want to delete the selected Video modules?")&&(b('input[type="submit"]').attr("disabled",!0),a=f.map(function(){return this.value}).get().join(","),b.post(d,{action:"pvm_crud",method:"delete",nonce:e,post_ids:a},c.ajaxCallback,"json"))):(alert("You must select at least one Video module to delete."),!1)},c.updateTerm=function(a){var f=b(this);a.keyCode===b.ui.keyCode.TAB&&b(this).autocomplete("instance").menu.active&&a.preventDefault(),b(this).autocomplete({minLength:3,source:function(a,g){var h=f.parent().find(".pvm-target-tax option:selected").val();b.post(d,{action:"search_post_term",nonce:e,taxonomy:h,search:c.extractLast(a.term)},function(a){g(a.data)})},select:function(a,b){var d=c.split(this.value);return d.pop(),d.push(b.item.value),d.push(""),this.value=d.join(", "),!1}})},c.extractLast=function(a){return c.split(a).pop()},c.split=function(a){return a.split(/,\s*/)},c.updatePlaylist=function(){var a=b('input[name="video-count" ]');b(this).autocomplete({minLength:3,autoFocus:!0,source:function(c,f){a.attr("min","5"),a.attr("max","10"),a.val(5),b.post(d,{action:"search_playlist",nonce:e,search:c.term},function(a){f(a.data)})},select:function(a,b){c.fillPlaylistDetail(b.item.value)}})},c.updatePlaylistDetail=function(){var a=this.checkValidity(),d=b(".playlist-search-autocomplete").val();a&&d&&c.fillPlaylistDetail(d)},c.fillPlaylistDetail=function(a){var c,f=b('input[name="video-count"]'),g=document.getElementById("get-featured-video");b.post(d,{action:"get_playlist_details",nonce:e,count:f.val(),playlist:a},function(a){b(g).find("option").remove(),a.success?(g.disabled=!1,5>a.data.count?(f.attr("min",a.data.count),f.attr("max",a.data.count),f.val(a.data.count)):10>a.data.count&&(f.attr("min","5"),f.attr("max",a.data.count)),b.each(a.data.items,function(a,b){var c=document.createElement("option");c.value=a,c.innerHTML=b,g.appendChild(c)})):(c=document.createElement("option"),c.innerHTML=a.data.msg,g.appendChild(c))})},c.addTaxRelation=function(){var a,d=b('input[name="target-term[]"]'),e=!1;b.each(d,function(){var a=b(this),c=a.val();c||(e=a,a.focus())}),e||(a=b(".add-tax-relation-row:first")[0],a=b(a).clone(),a.find('select[name="target-tax[]"]').val(b('select[name="target-tax[]"] option:first').val()),a.find('input[name="target-term[]"]').val(""),b("div.pvm-tax-relation").append(a),c.updateAddTaxButton())},c.removeTaxRelation=function(){b(this).parent("div.add-tax-relation-row").remove(),c.updateAddTaxButton()},c.updateAddTaxButton=function(){var a=b(".add-tax-relation-row a");1===b(a).size()?b(a).addClass("add-tax-relation").removeClass("remove-tax-relation").text("+"):b(a).removeClass("add-tax-relation").addClass("remove-tax-relation").text("x")},c.updateTermFieldText=function(){b(this).parent().find("input.pvm-target-term").attr("placeholder","Insert "+b(this).val()+", separated by commas")},c.initialize()};b(function(){a.PMCVideoPlaylistManager=new c})}(window,jQuery);