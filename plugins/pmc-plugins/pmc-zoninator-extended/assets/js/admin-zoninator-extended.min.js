/*!
 * PMC Zoninator Extended JavaScript Library
 */
var pmc=pmc||{};pmc.zoninator_extended=pmc.zoninator_extended||{},function(a){"use strict";var b=a.fn.append;a.fn.append=function(){return b.apply(this,arguments).trigger("append")},pmc.zoninator_extended={dialog:!1,init:function(){this.dialog=a("#pmc-zoninator-quick-post-edit-modal").dialog({autoOpen:!1,draggable:!1,closeOnEscape:!0,minWidth:500,close:this.on_dialog_close,buttons:[{text:"Save",click:this.on_post_save}]}),this.add_quick_edit_link(),this.events(),wp.heartbeat.interval(15)},events:function(){var b=this,c=a(".zone-post");c.on("dblclick",this.on_dblclick_zone_post),zoninator.$zonePostsList.bind("append",function(d){"undefined"!==d.target.tagName&&"DIV"===d.target.tagName&&a(d.target).hasClass("zone-posts-list")&&(b.add_quick_edit_link(),c.unbind("dblclick",b.on_dblclick_zone_post),c.on("dblclick",b.on_dblclick_zone_post))}),a(document).on("heartbeat-send",this.on_heartbeat_send),a(document).on("heartbeat-tick",this.on_heartbeat_tick)},on_heartbeat_send:function(b,c){c.post_ids=[],a(".zone-posts-list > div").each(function(){var b=a(this).data("post-id");b=parseInt(b,0),c.post_ids.push(b)})},on_heartbeat_tick:function(b,c){var d=c.post_lock_status;for(var e in d){var f=d[e].post_id,g=a("#zone-post-"+f,".zone-posts-list"),h=a(".row-actions",g);if(a(".lock-message",h).remove(),a(".quick-edit",h).remove(),g.unbind("dblclick",pmc.zoninator_extended.on_dblclick_zone_post),d[e].lock_holder){var i=document.createElement("span");i=a(i),i.text(d[e].message).addClass("lock-message"),h.append(i)}else{var j=document.createElement("a");j=a(j),j.text("Quick Edit").attr("href","javascript:").addClass("quick-edit").on("click",pmc.zoninator_extended.on_click_quick_edit),h.append(j),g.bind("dblclick",pmc.zoninator_extended.on_dblclick_zone_post)}}},add_quick_edit_link:function(){var b=a(".zone-post .row-actions"),c=" | ",d=document.createElement("a");d=a(d),d.text("Quick Edit").attr("href","javascript:").addClass("quick-edit").on("click",this.on_click_quick_edit),a(".quick-edit",b).remove(),b.append(c),b.append(d)},on_click_quick_edit:function(){var b=a(this).parents("div.zone-post"),c=a(b).data("post-id");c=parseInt(c,0),pmc.zoninator_extended.open_modal(c)},on_dblclick_zone_post:function(){var b=a(this).data("post-id");b=parseInt(b,0),pmc.zoninator_extended.open_modal(b)},open_modal:function(b){var c=this;zoninator.$zonePostSearch.trigger("loading.start"),a.ajax({url:ajaxurl,type:"POST",data:{action:"pmc_zoninator_get_post",nonce:pmc_admin_zoninator_options.get_nonce,security:pmc_admin_zoninator_options.security,zone_id:pmc_admin_zoninator_options.zone_id,post_id:b},success:function(a){return zoninator.$zonePostSearch.trigger("loading.end"),!0!==a.success&&"undefined"!=typeof console?void console.error("Failed to retrieve post data"):(c.set_modal(a.data),void c.dialog.dialog("open"))},error:function(){if(zoninator.$zonePostSearch.trigger("loading.end"),"undefined"!=typeof console)return void console.error("Failed to retrieve post data")}})},on_dialog_close:function(){pmc.zoninator_extended.reset_modal()},on_post_save:function(b){var c=a("#pmc-zoninator-quick-post-edit-modal"),d=a("#checklist-category input[type=checkbox]",c),e=a("#checklist-editorial input[type=checkbox]",c),f=!1,g=[],h=[],i=0,j=a("#post_id",c).val();j=parseInt(j,0),"undefined"!=typeof b.target&&(f=a(b.target));for(var k=0;k<d.length;k++)!0===d[k].checked&&(i=parseInt(d[k].value,0),g.push(i));for(var k=0;k<e.length;k++)!0===e[k].checked&&(i=parseInt(e[k].value,0),h.push(i));f.attr("disabled","disabled").children("span").text("Saving..."),a.ajax({url:ajaxurl,type:"POST",data:{action:"pmc_zoninator_update_post",nonce:pmc_admin_zoninator_options.update_nonce,security:pmc_admin_zoninator_options.security,zone_id:pmc_admin_zoninator_options.zone_id,post_id:j,data:{category:g,editorial:h}},success:function(a){if(f.removeAttr("disabled").children("span").text("Save"),pmc.zoninator_extended.reset_modal(),pmc.zoninator_extended.dialog.dialog("close"),!0!==a.success&&"undefined"!=typeof console)return void console.error("Failed to update post data")},error:function(){if(f.removeAttr("disabled").children("span").text("Save"),pmc.zoninator_extended.reset_modal(),pmc.zoninator_extended.dialog.dialog("close"),"undefined"!=typeof console)return void console.error("Failed to update post data")}})},reset_modal:function(){var b,c=a("#pmc-zoninator-quick-post-edit-modal"),d=a("#checklist-category input[type=checkbox]",c),e=a("#checklist-editorial input[type=checkbox]",c);for(a("#post_id",c).val(""),a("#post_title",c).val(""),a("#post_slug",c).val(""),a("#editorial-row",c).addClass("hide"),b=0;b<d.length;b++)d[b].checked=!1;for(b=0;b<e.length;b++)e[b].checked=!1},set_modal:function(b){var c=a("#pmc-zoninator-quick-post-edit-modal"),d=0,e=0;if(this.reset_modal(),a("#post_id",c).val(b.ID),a("#post_title",c).val(b.post_title),a("#post_slug",c).val(b.post_name),"undefined"!=typeof b.post_category)for(e in b.post_category)d=b.post_category[e],a("#in-category-"+d)[0].checked=!0;if("undefined"!=typeof b.post_editorial){a("#editorial-row",c).removeClass("hide");for(e in b.post_editorial)d=b.post_editorial[e],a("#in-editorial-"+d)[0].checked=!0}}},a(document).ready(function(){pmc.zoninator_extended.init()})}(jQuery);
