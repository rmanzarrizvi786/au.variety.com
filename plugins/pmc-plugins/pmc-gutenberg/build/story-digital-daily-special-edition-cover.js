!function(){"use strict";var e=window.wp.blocks,t=window.wp.i18n,l=window.wp.element,a=window.wp.primitives,r=(0,l.createElement)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,l.createElement)(a.Path,{d:"M18.7 3H5.3C4 3 3 4 3 5.3v13.4C3 20 4 21 5.3 21h13.4c1.3 0 2.3-1 2.3-2.3V5.3C21 4 20 3 18.7 3zm.8 15.7c0 .4-.4.8-.8.8H5.3c-.4 0-.8-.4-.8-.8V5.3c0-.4.4-.8.8-.8h6.2v8.9l2.5-3.1 2.5 3.1V4.5h2.2c.4 0 .8.4.8.8v13.4z"}));const n=e=>`pmc_${e.split("/")[1].replace(/-/g,"_")}_block_config`;var o=window.lodash,s=window.wp.data;const c={className:{type:"string",default:""},postType:{type:"string",default:"post"},postID:{type:"number",default:null},taxonomySlug:{type:"string",default:null},viewMoreText:{type:"string",default:null},hasDisplayedExcerpt:{type:"boolean",default:!0},hasDisplayedByline:{type:"boolean",default:!0},hasDisplayedPrimaryTerm:{type:"boolean",default:!0},hasFullWidthImage:{type:"boolean",default:!1},alignment:{type:"string",default:"none"},title:{type:"string",default:null},excerpt:{type:"string",default:null},featuredImageID:{type:"number",default:null},contentOverride:{type:"string",default:null},hasContentOverride:{type:"boolean",default:!1},backgroundColor:{type:"string",default:null}};var i=window.wp.blockEditor,p=window.wp.components,m=(0,l.createElement)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,l.createElement)(a.Path,{d:"M4 19.8h8.9v-1.5H4v1.5zm8.9-15.6H4v1.5h8.9V4.2zm-8.9 7v1.5h16v-1.5H4z"})),u=(0,l.createElement)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,l.createElement)(a.Path,{d:"M11.1 19.8H20v-1.5h-8.9v1.5zm0-15.6v1.5H20V4.2h-8.9zM4 12.8h16v-1.5H4v1.5z"})),d=(0,l.createElement)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,l.createElement)(a.Path,{d:"M16.4 4.2H7.6v1.5h8.9V4.2zM4 11.2v1.5h16v-1.5H4zm3.6 8.6h8.9v-1.5H7.6v1.5z"})),g=window.wp.compose;const h=({onChange:e})=>{const a=(0,g.useInstanceId)(h);return(0,l.createElement)("div",null,(0,l.createElement)("label",{htmlFor:`pmc-story-card__search-${a}`},(0,t.__)("Next, search for a post by title: ","pmc-gutenberg")),(0,l.createElement)("input",{style:{width:"100%"},id:`pmc-story-card__search-${a}`,type:"search",placeholder:(0,t.__)("Search for a post","pmc-gutenberg"),onChange:t=>e(t.target.value),autoComplete:"off"}))},_=({postType:e,onChangePostID:a,onMorePosts:r,maxPosts:n,keywords:c})=>{const{posts:i,morePostsAvailable:m,isLoading:u}=(0,s.useSelect)((t=>{const l="postType",a=e,r={per_page:100,orderby:"date",order:"desc",status:["publish","draft","future"],search:c},{getEntityRecords:s,getMedia:i}=t("core"),{isResolving:p}=t("core/data");let m=[];for(let e=1;e<=Math.ceil(n/100);e++){const t=s(l,a,{...r,page:e});t&&(m=m.concat(t))}return{posts:Array.isArray(m)?m.slice(0,n).map((e=>(({post:e,getMedia:t})=>{if(e&&e.featured_media){const l=t(e.featured_media);let a=(0,o.get)(l,["media_details","sizes","large","source_url"],null);return a||(a=(0,o.get)(l,"source_url",null)),{...e,featuredImageSourceUrl:a,featuredImageAltText:l&&l.alt_text?l.alt_text:""}}return e})({post:e,getMedia:i}))):m,morePostsAvailable:()=>m.length>n,isLoading:()=>{const e=[!1];for(let t=1;t<=Math.ceil(n/100);t++)e.push(p("core","getEntityRecords",[l,a,{...r,page:t}]));for(const t of m.slice(0,n))t&&e.push(p("core","getMedia",[t.featured_media]));return e.reduce(((e,t)=>e||t))}}}),[c,n]);return i&&i.length>0?(0,l.createElement)("fieldset",{className:"pmc-story-card-search-results__fieldset"},(0,l.createElement)(p.VisuallyHidden,{as:"legend"},(0,t.__)("Choose a post","pmc-gutenberg")),(0,l.createElement)("ol",{className:"pmc-story-card-search-results__list"},i.map((e=>e?(0,l.createElement)("li",{className:"pmc-story-card-search-results__item",key:e.id},(0,l.createElement)(p.Button,{isSecondary:!0,onClick:()=>{a(e.id)},className:"pmc-story-card-search-results__button"},(0,l.createElement)("span",{className:"pmc-story-card-search-results__title"},e.title.raw,(0,l.createElement)("i",{className:"pmc-story-card-search-results__title-label"},"publish"!==e.status?" - "+e.status:"")),(0,l.createElement)("span",{className:"pmc-story-card-search-results__image-container"},(0,l.createElement)("img",{className:"pmc-story-card-search-results__image",src:e.featuredImageSourceUrl,alt:e.featuredImageAltText})))):""))),m()&&(0,l.createElement)(p.Button,{className:"pmc-story-card-search-results__more-button",isPrimary:!0,disabled:u(),isBusy:u(),onClick:()=>{r()}},"More Posts")):u()?(0,l.createElement)(p.Spinner,null):c?(0,l.createElement)("p",{className:"pmc-story-card-search-results__note"},`No posts found for “${c}”.`):(0,l.createElement)("p",{className:"pmc-story-card-search-results__note"},"No posts found.")},y=({onChangePostType:e,postType:a,onChangePostID:r,postTypeSelectOptions:n})=>{const[o,s]=(0,l.useState)(null),[c,i]=(0,l.useState)(5);return(0,l.createElement)(p.Placeholder,{className:"pmc-story-card-setup",icon:"format-aside",label:(0,t.__)("Story Setup","pmc-gutenberg"),instructions:(0,t.__)("Choose a post to display in this story card.","pmc-gutenberg"),isColumnLayout:!0},(0,l.createElement)(p.SelectControl,{label:(0,t.__)("First, select a post type to search: ","pmc-gutenberg"),value:a,onChange:e,options:n}),(0,l.createElement)(h,{onChange:s}),(0,l.createElement)("div",{style:{minHeight:"200px"}},(0,l.createElement)(_,{keywords:o,maxPosts:c,postType:a,onChangePostID:r,onMorePosts:function(){i(c+5)}})))},b=({imageID:e,hasFullWidthImage:t})=>{const{src:a,alt:r}=(0,s.useSelect)((t=>{const l={src:null,alt:null};if(e<1)return l;const{getMedia:a}=t("core"),r=a(e);let n=(0,o.get)(r,["media_details","sizes","large","source_url"],null);return n||(n=(0,o.get)(r,"source_url",null)),l.src=n,l.alt=r&&r.alt_text?r.alt_text:"",l}),[e]);return a?(0,l.createElement)("img",{src:a,alt:r,style:{width:t?"auto":"50%"},className:"pmc-story-card-preview__featured-image"}):(0,l.createElement)(p.Spinner,null)},v=({value:e,onChange:t})=>(0,l.createElement)(i.RichText,{value:e,onChange:t,allowedFormats:["core/bold","core/italic"],className:"pmc-story-card-preview__title"}),w=({value:e,onChange:t})=>(0,l.createElement)(i.RichText,{value:e,onChange:t,allowedFormats:[],className:"pmc-story-card-preview__excerpt"}),E=({postType:e,postID:a,contentOverride:r,hasContentOverride:n,hasDisplayedExcerpt:o,hasFullWidthImage:c,alignment:m,title:u,excerpt:d,featuredImageID:g,onContentOverrideUpdate:h,onChangeTitle:_,onChangeExcerpt:y,viewMoreText:E})=>{var f;const C=(0,s.useSelect)((t=>{const{getEntityRecord:l}=t("core");return l("postType",e,a)}),[a]);if(!C)return(0,l.createElement)(p.Spinner,null);const x=null!==(f=null!=g?g:C.featured_media)&&void 0!==f&&f;return d||(d=C.excerpt?C.excerpt.rendered:""),(0,l.createElement)("div",{className:"pmc-story-card-edit",style:{textAlign:m}},(0,l.createElement)(v,{value:u||C.title.raw,onChange:_}),Boolean(x)&&(0,l.createElement)(b,{imageID:x,hasFullWidthImage:c}),Boolean(o)&&(0,l.createElement)(w,{value:d,onChange:y}),(0,l.createElement)("p",{className:"pmc-story-card-preview__link"},(0,l.createElement)("a",{href:C.link},E)),a&&n&&(0,l.createElement)(i.RichText,{value:r,placeholder:(0,t.__)("Enter excerpt override…","pmc-gutenberg"),onChange:h,tagName:"p"}))},f=(0,i.withColors)("backgroundColor",{backgroundColor:"color"})((a=>{const{attributes:{postType:r,postID:o,contentOverride:g,hasContentOverride:h,hasDisplayedExcerpt:_,hasDisplayedByline:b,hasDisplayedPrimaryTerm:v,hasFullWidthImage:w,alignment:f,title:x,excerpt:T,featuredImageID:I,viewMoreText:k,className:S},backgroundColor:D,name:P,setAttributes:M,setBackgroundColor:N}=a,{__unstableMarkNextChangeAsNotPersistent:O}=(0,s.useDispatch)("core/block-editor"),B=window[n(P)],z=C(B),F=(0,e.hasBlockSupport)(P,"pmc.colors.background",!1),R=(0,e.hasBlockSupport)(P,"pmc.contentOverride",!1),A=(0,e.hasBlockSupport)(P,"pmc.fullWidthImage",!1),H=e=>{M({taxonomySlug:B[e].taxonomySlug,viewMoreText:B[e].viewMoreText})};O(),H(r);const V=e=>{M({alignment:void 0===e?"none":e})},W=[{icon:m,title:(0,t.__)("Align left","pmc-gutenberg"),align:"left"}];(null===S||void 0!==S&&-1!==S.indexOf("horizontal"))&&(W.push({icon:u,title:(0,t.__)("Align right","pmc-gutenberg"),align:"right"}),"center"===f&&V("right")),void 0!==S&&-1!==S.indexOf("vertical")&&(W.push({icon:d,title:(0,t.__)("Align center","pmc-gutenberg"),align:"center"}),"right"===f&&V("center"));const U=(0,p.withFilters)("pmcGutenberg.storyBlock.additionalDisplayControls")((e=>(0,l.createElement)(l.Fragment,null)));return(0,l.createElement)(l.Fragment,null,o&&(0,l.createElement)(i.BlockControls,null,(0,l.createElement)(i.AlignmentToolbar,{value:f,onChange:V,alignmentControls:W}),(0,l.createElement)(p.ToolbarButton,{label:(0,t.__)("Replace","pmc-gutenberg"),onClick:()=>{const e={};for(const[t,l]of Object.entries(c))e[t]=l.default;e.postType=r,e.taxonomySlug=B[r].taxonomySlug,e.viewMoreText=B[r].viewMoreText,M(e)}},(0,t.__)("Replace","pmc-gutenberg")),(0,l.createElement)(i.MediaReplaceFlow,{allowedTypes:["image"],accept:"image/*",onSelect:e=>{M({featuredImageID:void 0===e?null:e.id})},name:(0,t.__)("Override Image","pmc-gutenberg")})),o?(0,l.createElement)(E,{postType:r,postID:o,contentOverride:g,hasContentOverride:h,hasDisplayedExcerpt:_,hasFullWidthImage:w,alignment:f,title:x,excerpt:T,featuredImageID:I,onChangeTitle:e=>{M({title:void 0===e?null:e})},onChangeExcerpt:e=>{M({excerpt:void 0===e?null:e})},onContentOverrideUpdate:e=>{M({contentOverride:e})},viewMoreText:k}):(0,l.createElement)(y,{postType:r,onChangePostID:e=>{M({postID:void 0===e?null:e})},onChangePostType:e=>{M({postType:e}),H(e)},placeholderTitle:(0,t.__)("Select a Story","pmc-gutenberg"),postTypeSelectOptions:z}),(0,l.createElement)(i.InspectorControls,null,(0,l.createElement)(p.Panel,null,(0,l.createElement)(p.PanelBody,{title:(0,t.__)("Display Settings","pmc-gutenberg"),initialOpen:!0},(0,l.createElement)(p.PanelRow,null,(0,l.createElement)(p.ToggleControl,{label:(0,t.__)("Display dek?","pmc-gutenberg"),help:_?(0,t.__)("Dek will be shown (if design includes it).","pmc-gutenberg"):(0,t.__)("Dek will be hidden (if design includes it).","pmc-gutenberg"),checked:_,onChange:e=>{M({hasDisplayedExcerpt:void 0===e||e})}})),(0,l.createElement)(p.PanelRow,null,(0,l.createElement)(p.ToggleControl,{label:(0,t.__)("Display byline?","pmc-gutenberg"),help:b?(0,t.__)("Byline will be shown (if design includes it).","pmc-gutenberg"):(0,t.__)("Byline will be hidden (if design includes it).","pmc-gutenberg"),checked:b,onChange:e=>{M({hasDisplayedByline:void 0===e||e})}})),(0,l.createElement)(p.PanelRow,null,(0,l.createElement)(p.ToggleControl,{label:(0,t.__)("Display breadcrumb?","pmc-gutenberg"),help:v?(0,t.__)("Taxonomy term (breadcrumb) will be shown (if design includes it).","pmc-gutenberg"):(0,t.__)("Taxonomy term (breadcrumb) will be hidden (if design includes it).","pmc-gutenberg"),checked:v,onChange:e=>{M({hasDisplayedPrimaryTerm:void 0===e||e})}})),A&&(0,l.createElement)(p.PanelRow,null,(0,l.createElement)(p.ToggleControl,{label:(0,t.__)("Make image full-width","pmc-gutenberg"),help:w?(0,t.__)("Image fills the width of the story card.","pmc-gutenberg"):(0,t.__)("Image is thumbnail size.","pmc-gutenberg"),checked:w,onChange:e=>{M({hasFullWidthImage:void 0!==e&&e})}})),R&&(0,l.createElement)(p.PanelRow,null,(0,l.createElement)(p.ToggleControl,{label:(0,t.__)("Override excerpt?","pmc-gutenberg"),help:h?(0,t.__)("Use customized post excerpt.","pmc-gutenberg"):(0,t.__)("Use automatically-generated excerpt.","pmc-gutenberg"),checked:h,onChange:e=>{M({hasContentOverride:e})}})),(0,l.createElement)(U,a)),F&&(0,l.createElement)(i.PanelColorSettings,{title:(0,t.__)("Colors","pmc-gutenberg"),colorSettings:[{value:D.color,onChange:N,label:(0,t.__)("Background Color","pmc-gutenberg")}]}))))})),C=e=>{const{getPostTypes:t}=(0,s.select)("core"),l=t({per_page:-1});return Object.keys(e).map((t=>{const a=e[t].postType,r=null==l?void 0:l.filter((e=>a===e.slug));return{value:a,label:void 0===r||1!==r.length?a:r[0].labels.name}}))},x="pmc/story-digital-daily-special-edition-cover",T=window[n(x)],I=((e={})=>(0,o.merge)({},{title:(0,t.__)("PMC Story","pmc-gutenberg"),description:(0,t.__)("Show a post summary and a link","pmc-gutenberg"),category:"embed",icon:"format-aside",supports:{anchor:!1,customClassName:!1,html:!1,pmc:{colors:{background:!1},contentOverride:!1,fullWidthImage:!1}},attributes:c,edit:f,save:()=>null},e))({title:(0,t.__)("PMC Digital Daily Special Edition Cover","pmc-gutenberg"),attributes:{postType:{default:Object.keys(T)[0]}},category:"media",description:(0,t.__)("Display cover for Special Edition article","pmc-gutenberg"),icon:r,supports:{multiple:!1,pmc:{contentOverride:!0}}});(0,e.registerBlockType)(x,I)}();