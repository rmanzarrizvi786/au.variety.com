!function(){"use strict";var e={n:function(t){var l=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(l,{a:l}),l},d:function(t,l){for(var a in l)e.o(l,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:l[a]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.blocks,l=window.wp.i18n,a=window.wp.element,r=window.wp.blockEditor,n=window.wp.components,s=window.wp.compose,o=window.wp.data;const i="pmcJwPlayer",c="players";var m=(0,s.compose)([(0,o.withSelect)((e=>{const{getEntityRecords:t,hasFinishedResolution:l}=e("core"),a=t(i,c);return{isResolving:!l("getEntityRecords",[i,c]),players:a}})),(0,o.withDispatch)((e=>{const{addEntities:t}=e("core");t([{name:c,kind:i,baseURL:"/pmc/video-player/jw-player/v1/players",label:(0,l.__)("JW Player Players","pmc-gutenberg"),key:"value"}])}))])((({isResolving:e,playerId:t,players:s,setAttributes:o})=>(0,a.createElement)(r.InspectorControls,null,(0,a.createElement)(n.Panel,null,(0,a.createElement)(n.PanelBody,{title:(0,l.__)("Overrides","pmc-gutenberg"),initialOpen:!1},(0,a.createElement)(n.PanelRow,null,e&&(0,a.createElement)(n.Spinner,null),!e&&(0,a.createElement)(n.SelectControl,{label:(0,l.__)("Select player","pmc-gutenberg"),help:(0,l.__)("Override the player used for this video.","pmc-gutenberg"),onChange:e=>o({playerId:e}),options:s,value:t}))))))),d=window.wp.viewport,p=({imageWidth:e,isPlaylist:t,videoId:r})=>{const[s,i]=(0,a.useState)("");let c;if(e)c=parseInt(e,10);else{const e=(0,o.select)(d.store).isViewportMatch("< small");c=e?320:720}if((0,a.useEffect)((()=>{i(`https://assets-jpcust.jwpsrv.com/thumbnails/generic/video-${c}.jpg`)}),[]),t)return(0,a.createElement)(n.Dashicon,{icon:"playlist-video"});const m=`https://content.jwplatform.com/thumbs/${r}-${c}.jpg`;return s!==m&&window.fetch(m,{credentials:"omit"}).then((e=>{200===e.status&&i(m)})),(0,a.createElement)("img",{src:s,width:c,alt:(0,l.__)("JW Player preview image","pmc-gutenberg")})},u=({clearSelectedVideo:e,isPlaylist:t,selectionTitle:s,videoId:o})=>(0,a.createElement)(a.Fragment,null,(0,a.createElement)(r.BlockControls,{group:"other"},(0,a.createElement)(n.ToolbarButton,{onClick:e},(0,l.__)("Replace","pmc-gutenberg"))),(0,a.createElement)("p",{className:"pmc-jw-player-preview-wrapper"},!t&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)("span",null,s),(0,a.createElement)("br",null)),(0,a.createElement)(p,{isPlaylist:t,videoId:o}),t&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)("br",null),(0,a.createElement)("span",null,s)))),g=window.wp.primitives,y=(0,a.createElement)(g.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,a.createElement)(g.Path,{d:"M18.7 3H5.3C4 3 3 4 3 5.3v13.4C3 20 4 21 5.3 21h13.4c1.3 0 2.3-1 2.3-2.3V5.3C21 4 20 3 18.7 3zm.8 15.7c0 .4-.4.8-.8.8H5.3c-.4 0-.8-.4-.8-.8V5.3c0-.4.4-.8.8-.8h13.4c.4 0 .8.4.8.8v13.4zM10 15l5-3-5-3v6z"})),h=(0,a.createElement)(g.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"-2 -2 24 24"},(0,a.createElement)(g.Path,{d:"M6.734 16.106l2.176-2.38-1.093-1.028-3.846 4.158 3.846 4.157 1.093-1.027-2.176-2.38h2.811c1.125 0 2.25.03 3.374 0 1.428-.001 3.362-.25 4.963-1.277 1.66-1.065 2.868-2.906 2.868-5.859 0-2.479-1.327-4.896-3.65-5.93-1.82-.813-3.044-.8-4.806-.788l-.567.002v1.5c.184 0 .368 0 .553-.002 1.82-.007 2.704-.014 4.21.657 1.854.827 2.76 2.657 2.76 4.561 0 2.472-.973 3.824-2.178 4.596-1.258.807-2.864 1.04-4.163 1.04h-.02c-1.115.03-2.229 0-3.344 0H6.734z"})),b=window.wp.apiFetch,w=e.n(b);const v="pmc-jw-player-button-row";var E=({closeModal:e,setAttributes:t})=>{const[s,o]=(0,a.useState)(""),[i,c]=(0,a.useState)(!1),[m,d]=(0,a.useState)(!1),[p,u]=(0,a.useState)(""),[g,y]=(0,a.useState)(""),b=e=>{o(e.error),c(!1)},E=l=>{t({isPlaylist:!1,selectionTitle:p,videoId:l.videoId}),e()};return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(n.TextControl,{label:(0,l._x)("Title","Video title submitted to JW Player","pmc-gutenberg"),help:(0,l.__)("Enter video title. If omitted, the filename is used.","pmc-gutenberg"),onChange:u}),i&&(0,a.createElement)(n.Spinner,null),!i&&(0,a.createElement)("div",{className:v},(0,a.createElement)(n.FormFileUpload,{accept:"video/*",icon:"cloud-upload",isPrimary:!0,multiple:"false",onChange:e=>{var t;t=e.target.files[0],o(""),c(!0),(async(e,t)=>{const a={success:!1};return await w()({path:"/pmc/video-player/jw-player/v1/upload",method:"POST",data:{filename:e.name,title:t}}).then((async t=>{const r=new window.FormData;r.set("file",e,e.name),await window.fetch(t.url,{method:"POST",body:r,headers:{"X-Session-ID":t.session_id}}).then((e=>e.json())).then((e=>{a.videoId=e.media.key,a.success=!0})).catch((e=>{a.error=(0,l.sprintf)(
/* translators: 1. Error text from JW Player API. */
(0,l.__)("The video could not be uploaded due to an error: %s","pmc-gutenberg"),e.message)}))})).catch((e=>{a.error=e.message})),a.success?a:Promise.reject(a)})(t,p).then(E).catch(b)}},(0,l._x)("Upload file","Upload video file to JW Player","pmc-gutenberg")),(0,a.createElement)(n.Button,{isSecondary:!0,onClick:()=>d(!0),icon:"admin-links"},(0,l._x)("Add from URL","Add video to JW Player from an existing URL.","pmc-gutenberg")),(0,a.createElement)(n.Button,{className:`${v}-cancel`,isTertiary:!0,onClick:e},(0,l._x)("Cancel","Cancel JW Player upload and close modal","pmc-gutenberg"))),m&&!i&&(0,a.createElement)(r.URLPopover,{onClose:()=>d(!1)},(0,a.createElement)("form",{className:"block-editor-url-popover__link-editor",onSubmit:e=>{var t;e.preventDefault(),d(!1),t=g,o(""),c(!0),(async(e,t)=>{const l={success:!1};return await w()({path:"/pmc/video-player/jw-player/v1/import",method:"POST",data:{title:t,url:e}}).then((e=>{l.videoId=e.key,l.success=!0})).catch((e=>{l.error=e.message})),l.success?l:Promise.reject(l)})(t,p).then(E).catch(b)}},(0,a.createElement)("div",{className:"block-editor-url-input"},(0,a.createElement)(r.URLInput,{value:g,onChange:y,placeholder:(0,l.__)("Enter video URL","pmc-gutenberg"),disableSuggestions:!0})),(0,a.createElement)(n.Button,{icon:h,label:(0,l._x)("Import","Import video URL into JW Player","pmc-gutenberg"),type:"submit"}))),!i&&Boolean(s.length)&&(0,a.createElement)(n.Notice,{isDismissible:!1,status:"error"},s))},_=window.lodash;const P="pmc-jw-player-results";var f=({closeModal:e,setAttributes:t})=>{const[r,s]=(0,a.useState)(!1),[o,i]=(0,a.useState)({message:"",type:"info"}),[c,m]=(0,a.useState)([]),[d,u]=(0,a.useState)(""),[g,y]=(0,a.useState)("video"),h=(0,a.useCallback)((0,_.debounce)((()=>{s(!0),i({message:""}),m([]),(async(e,t)=>{const l={success:!1};return await w()({path:"/pmc/video-player/jw-player/v1/search",method:"POST",data:{query:e,type:t}}).then((e=>{l.results=e,l.success=!0})).catch((e=>{l.error=e.message})),l.success?l:Promise.reject(l)})(d,g).then((e=>e.results)).then((e=>{m(e),0===e.length&&i({message:(0,l.__)("No results found.","pmc-gutenberg"),type:"warning"}),s(!1)})).catch((({error:e})=>{i({message:e,type:"error"}),s(!1)}))}),250),[d,g]);return(0,a.useEffect)((()=>(h(),h.cancel)),[d,g,h]),(0,a.createElement)(a.Fragment,null,(0,a.createElement)(n.TextControl,{label:(0,l.__)("Search","pmc-gutenberg"),help:(0,l.__)("Enter search term, such as ID, title, description, or tag.","pmc-gutenberg"),onChange:u}),(0,a.createElement)(n.RadioControl,{label:(0,l.__)("Type","pmc-gutenberg"),help:(0,l.__)("Search either videos or playlists.","pmc-gutenberg"),selected:g,options:[{label:(0,l.__)("Videos","pmc-gutenberg"),value:"video"},{label:(0,l.__)("Playlists","pmc-gutenberg"),value:"playlist"}],onChange:e=>{s(!0),y(e)}}),(0,a.createElement)("hr",null),r&&(0,a.createElement)(n.Spinner,null),!r&&Boolean(o.message.length)&&(0,a.createElement)(n.Notice,{isDismissible:!1,status:o.type},o.message),!r&&Boolean(c)&&(0,a.createElement)("ul",{className:P},c.map((l=>(0,a.createElement)("li",{className:`${P}-list`,key:l.key},(0,a.createElement)(n.Button,{className:`${P}-button`,onClick:()=>{t({isPlaylist:"playlist"===g,selectionTitle:l.title,videoId:l.key}),e()}},(0,a.createElement)("p",{className:`${P}-image-wrapper`},(0,a.createElement)(p,{imageWidth:"100",isPlaylist:"playlist"===g,videoId:l.key})),(0,a.createElement)("p",{className:`${P}-video-title`},l.title)))))))},S=({setAttributes:e})=>{const[t,r]=(0,a.useState)(!1),[s,i]=(0,a.useState)(!1),c={};(0,o.select)(d.store).isViewportMatch(">= medium")&&(c.minHeight="600px",c.minWidth="450px");const m=()=>r(!1),p=(0,l._x)("Select video","Select JW Player video from existing items","pmc-gutenberg"),u=()=>i(!1),g=(0,l._x)("Add new video","Add video to JW Player","pmc-gutenberg");return(0,a.createElement)(n.Placeholder,{icon:y,label:(0,l.__)("JW Player Video","pmc-gutenberg"),instructions:(0,l.__)("Embed a video hosted in JW Player, or add a new video to JW Player.","pmc-gutenberg")},(0,a.createElement)(n.Button,{isPrimary:!0,onClick:()=>r(!0)},p),t&&(0,a.createElement)(n.Modal,{onRequestClose:m,style:c,title:p},(0,a.createElement)(f,{closeModal:m,setAttributes:e})),(0,a.createElement)(n.Button,{onClick:()=>i(!0)},g),s&&(0,a.createElement)(n.Modal,{onRequestClose:u,title:g},(0,a.createElement)(E,{closeModal:u,setAttributes:e})))};const C={title:(0,l.__)("PMC JW Player","pmc-gutenberg"),description:(0,l.__)("Embed a video or playlist from JW Player","pmc-gutenberg"),category:"embed",icon:"format-video",supports:{anchor:!1,customClassName:!1,html:!1},attributes:{isPlaylist:{type:"boolean",default:!1},playerId:{type:"string",default:""},selectionTitle:{type:"string",default:"JW Player Embed"},videoId:{type:"string",default:""}},keywords:[(0,l.__)("embed","pmc-gutenberg"),(0,l.__)("jwplayer","pmc-gutenberg"),(0,l.__)("playlist","pmc-gutenberg"),(0,l.__)("video","pmc-gutenberg")],edit:({attributes:{isPlaylist:e,playerId:t,selectionTitle:l,videoId:r},setAttributes:n})=>(0,a.createElement)(a.Fragment,null,r?(0,a.createElement)(u,{isPlaylist:e,playerId:t,selectionTitle:l,videoId:r,clearSelectedVideo:()=>n({playerId:"",videoId:""})}):(0,a.createElement)(S,{setAttributes:n}),(0,a.createElement)(m,{playerId:t,setAttributes:n})),save:()=>null};(0,t.registerBlockType)("pmc/jw-player",C)}();